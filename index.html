<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>英単語クイズ</title>
<style>
body { font-family: sans-serif; max-width: 900px; margin: auto; }
section { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
textarea { width: 100%; height: 120px; }
.choice button { display: block; width: 100%; margin: 6px 0; padding: 10px; font-size: 16px; }
#quizScreen { display:none; }
</style>
</head>
<body>

<div id="homeScreen">

<h1>英単語クイズ</h1>

<section>
<h2>① ボックス作成</h2>
<input id="boxNameInput">
<button id="addBoxBtn">追加</button>
</section>

<section>
<h2>② 単語登録（改行で複数）</h2>
<select id="boxSelect"></select><br>
<textarea id="wordInput"></textarea><br>
<button id="addWordBtn">登録（自動翻訳）</button>
<span id="status"></span>
</section>

<section>
<h2>③ 出題範囲</h2>
<div id="boxChecks"></div>
<button id="startQuizBtn">クイズ開始</button>
</section>

<section>
<h2>④ 単語一覧</h2>
<button id="toggleListBtn">一覧表示</button>
<div id="wordList" style="display:none;"></div>
</section>

</div>

<div id="quizScreen">
<button id="backHomeBtn">← HOMEに戻る</button>
<h2 id="question"></h2>
<div class="choice" id="choices"></div>
<p id="result"></p>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

const $ = id => document.getElementById(id);
let data = JSON.parse(localStorage.getItem("wordData")) || {};
const save = () => localStorage.setItem("wordData", JSON.stringify(data));

async function translate(word){
  const r = await fetch(
    "https://api.mymemory.translated.net/get?q=" +
    encodeURIComponent(word) + "&langpair=en|ja"
  );
  const j = await r.json();
  return j.responseData.translatedText || "（翻訳失敗）";
}

/* ===== UI更新 ===== */
function updateUI(){
  $("boxSelect").innerHTML="";
  $("boxChecks").innerHTML="";
  for(const b in data){
    $("boxSelect").add(new Option(b,b));
    $("boxChecks").innerHTML +=
      `<label><input type="checkbox" value="${b}">${b}</label><br>`;
  }
}
updateUI();

/* ===== ボックス ===== */
$("addBoxBtn").onclick=()=>{
  const n=$("boxNameInput").value.trim();
  if(!n||data[n])return;
  data[n]={};
  save(); updateUI();
  $("boxNameInput").value="";
};

/* ===== 単語登録 ===== */
$("addWordBtn").onclick=async()=>{
  const box=$("boxSelect").value;
  const words=$("wordInput").value.split("\n").map(w=>w.trim()).filter(Boolean);
  if(!box||!words.length)return;
  $("status").textContent="翻訳中…";
  for(const w of words){
    if(data[box][w])continue;
    data[box][w]={meaning:await translate(w),history:[]};
    save();
  }
  $("status").textContent="登録完了";
  $("wordInput").value="";
};

/* ===== 単語一覧 ===== */
$("toggleListBtn").onclick=()=>{
  const l=$("wordList");
  l.style.display = l.style.display==="none"?"block":"none";
  $("toggleListBtn").textContent = l.style.display==="none"?"一覧表示":"閉じる";
  if(l.style.display==="block") renderList();
};

function renderList(){
  const div=$("wordList");
  div.innerHTML="";
  for(const b in data){
    div.innerHTML+=`<h3>${b}</h3>`;
    for(const w in data[b])
