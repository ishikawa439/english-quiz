<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>英単語レベル別クイズ</title>
<style>
body { font-family: sans-serif; max-width: 800px; margin: auto; }
section { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
button { margin: 5px; }
.choice button { display: block; width: 100%; margin: 4px 0; }
input[type="text"] { width: 200px; }
</style>
</head>
<body>

<h1>英単語レベル別クイズ</h1>

<section>
<h2>① 出題レベル選択</h2>
<label><input type="checkbox" class="levelCheck" value="level1"> レベル1</label>
<label><input type="checkbox" class="levelCheck" value="level2"> レベル2</label>
<label><input type="checkbox" class="levelCheck" value="level3"> レベル3</label>
</section>

<section>
<h2>② 単語一覧・意味編集</h2>
<button onclick="showWordList()">単語一覧を表示</button>
<div id="wordList"></div>
</section>

<section>
<h2>③ クイズ</h2>
<button onclick="startQuiz()">クイズ開始</button>
<h3 id="question"></h3>
<div class="choice" id="choices"></div>
<p id="result"></p>
</section>

<script>
// ====== 初期単語データ（例） ======
const defaultData = {
  level1: {
    apple: "りんご",
    book: "本",
    run: "走る"
  },
  level2: {
    decide: "決定する",
    explain: "説明する",
    improve: "改善する"
  },
  level3: {
    analyze: "分析する",
    assume: "仮定する",
    establish: "確立する"
  }
};

// ====== データ読み込み ======
let wordData = JSON.parse(localStorage.getItem("wordData")) || defaultData;

// ====== 単語一覧表示 ======
function showWordList() {
  const area = document.getElementById("wordList");
  area.innerHTML = "";
  for (let level in wordData) {
    area.innerHTML += `<h3>${level}</h3>`;
    for (let word in wordData[level]) {
      area.innerHTML += `
        ${word} :
        <input type="text" value="${wordData[level][word]}"
          onchange="updateMeaning('${level}','${word}',this.value)">
        <br>`;
    }
  }
}

function updateMeaning(level, word, value) {
  wordData[level][word] = value;
  localStorage.setItem("wordData", JSON.stringify(wordData));
}

// ====== クイズ処理 ======
let quizWords = [];
let wrongWords = [];
let currentIndex = 0;
let correctMeaning = "";

function startQuiz() {
  const checks = document.querySelectorAll(".levelCheck:checked");
  let pool = [];

  checks.forEach(c => {
    const levelWords = wordData[c.value];
    for (let w in levelWords) {
      pool.push({ word: w, meaning: levelWords[w] });
    }
  });

  if (pool.length < 10) {
    alert("10語以上選択してください");
    return;
  }

  quizWords = shuffle(pool).slice(0, 10);
  wrongWords = [];
  currentIndex = 0;
  nextQuestion();
}

function nextQuestion() {
  document.getElementById("result").textContent = "";
  if (currentIndex >= quizWords.length) {
    if (wrongWords.length > 0) {
      alert("間違えた問題をもう一度出します");
      quizWords = wrongWords;
      wrongWords = [];
      currentIndex = 0;
      nextQuestion();
    } else {
      alert("全問終了！");
    }
    return;
  }

  const q = quizWords[currentIndex];
  correctMeaning = q.meaning;

  let choices = [correctMeaning];
  let allMeanings = [];

  for (let level in wordData) {
    for (let w in wordData[level]) {
      allMeanings.push(wordData[level][w]);
    }
  }

  shuffle(allMeanings).forEach(m => {
    if (choices.length < 4 && !choices.includes(m)) {
      choices.push(m);
    }
  });

  shuffle(choices);

  document.getElementById("question").textContent =
    `(${currentIndex + 1}) ${q.word} の意味は？`;

  const cDiv = document.getElementById("choices");
  cDiv.innerHTML = "";

  choices.forEach(c => {
    const b = document.createElement("button");
    b.textContent = c;
    b.onclick = () => checkAnswer(c);
    cDiv.appendChild(b);
  });
}

function checkAnswer(ans) {
  if (ans === correctMeaning) {
    document.getElementById("result").textContent = "⭕ 正解";
  } else {
    document.getElementById("result").textContent =
      `❌ 不正解（正解：${correctMeaning}）`;
    wrongWords.push(quizWords[currentIndex]);
  }
  currentIndex++;
  setTimeout(nextQuestion, 800);
}

function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
</script>

</body>
</html>
